---
// Libs, types
import { getCollection } from "astro:content";
import { sortCollection } from "@lib/sort";
import { type Locale, locales, DEFAULT_LOCALE } from "@lib/date";

// Find current post (by slug) in sorted collection and return the next
// post. Wraps around to the oldest post
async function getNextPost(slug: string) {
	const allPosts = await getCollection("posts");
	const thisPostIndex = sortCollection(allPosts).findIndex(
		(post) => post.slug === slug,
	);
	return thisPostIndex === allPosts.length - 1
		? allPosts[0]
		: allPosts[thisPostIndex + 1];
}

type Props = {
	slug: string;
	lang: Locale;
};

const { slug, lang } = Astro.props;

const nextUpText = { [locales.NL]: "Lees ook ", [locales.EN]: "Next up: " }[
	lang || DEFAULT_LOCALE
];

const nextPost = await getNextPost(slug.replace("blog/", ""));
---

<nav>
	{nextUpText}
	<a href={`/blog/${nextPost.slug}/`}>{nextPost.data.title} &rarr;</a>
</nav>
